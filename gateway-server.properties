server.port=1111

spring.main.web-application-type=reactive

# Discovery locator (Spring Cloud Gateway 4.x)
spring.cloud.gateway.server.webflux.discovery.locator.enabled=true
spring.cloud.gateway.server.webflux.discovery.locator.lower-case-service-id=true

# Configuration des routes avec Circuit Breaker (Spring Cloud Gateway 4.x)
spring.cloud.gateway.server.webflux.routes[0].id=employe-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://EMPLOYE-SERVICE
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/employes/**

# IMPORTANT: Syntaxe correcte pour le filtre CircuitBreaker
spring.cloud.gateway.server.webflux.routes[0].filters[0].name=CircuitBreaker
spring.cloud.gateway.server.webflux.routes[0].filters[0].args.name=employeServiceGateway
spring.cloud.gateway.server.webflux.routes[0].filters[0].args.fallbackUri=forward:/fallback/employes

# IGNORER les 404 pour NE PAS activer le fallback Gateway
spring.cloud.gateway.server.webflux.routes[0].filters[0].args.statusCodes=500,502,503,504


# Resilience4j Circuit Breaker pour Gateway
resilience4j.circuitbreaker.instances.employeServiceGateway.sliding-window-size=10
resilience4j.circuitbreaker.instances.employeServiceGateway.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.employeServiceGateway.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.employeServiceGateway.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.employeServiceGateway.minimum-number-of-calls=5

# Time Limiter (timeout pour les appels)
resilience4j.timelimiter.instances.employeServiceGateway.timeout-duration=5s