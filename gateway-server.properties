# =========================
# SERVER
# =========================
server.port=1111
spring.application.name=gateway-server

# =========================
# SPRING CLOUD GATEWAY - DISCOVERY
# =========================
spring.cloud.gateway.server.webflux.discovery.locator.enabled=true
spring.cloud.gateway.server.webflux.discovery.locator.lower-case-service-id=true

# =========================
# ROUTES EXPLICITES AVEC CIRCUIT BREAKER
# =========================

# Route pour EMPLOYE-SERVICE
spring.cloud.gateway.server.webflux.routes[0].id=employe-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://employe-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/employe-service/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=RewritePath=/employe-service/(?<segment>.*), /$\{segment}
spring.cloud.gateway.server.webflux.routes[0].filters[1].name=CircuitBreaker
spring.cloud.gateway.server.webflux.routes[0].filters[1].args.name=employeServiceCB
spring.cloud.gateway.server.webflux.routes[0].filters[1].args.fallbackUri=forward:/fallback/employes

# Route pour CONGE-SERVICE
spring.cloud.gateway.server.webflux.routes[1].id=conge-service
spring.cloud.gateway.server.webflux.routes[1].uri=lb://conge-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/conge-service/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=RewritePath=/conge-service/(?<segment>.*), /$\{segment}
spring.cloud.gateway.server.webflux.routes[1].filters[1].name=CircuitBreaker
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.name=congeServiceCB
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.fallbackUri=forward:/fallback/conges

# =========================
# RESILIENCE4J - CIRCUIT BREAKER EMPLOYE
# =========================
resilience4j.circuitbreaker.instances.employeServiceCB.sliding-window-size=10
resilience4j.circuitbreaker.instances.employeServiceCB.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.employeServiceCB.minimum-number-of-calls=3
resilience4j.circuitbreaker.instances.employeServiceCB.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.employeServiceCB.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.employeServiceCB.automatic-transition-from-open-to-half-open-enabled=true

# =========================
# RESILIENCE4J - CIRCUIT BREAKER CONGE
# =========================
resilience4j.circuitbreaker.instances.congeServiceCB.sliding-window-size=10
resilience4j.circuitbreaker.instances.congeServiceCB.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.congeServiceCB.minimum-number-of-calls=3
resilience4j.circuitbreaker.instances.congeServiceCB.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.congeServiceCB.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.congeServiceCB.automatic-transition-from-open-to-half-open-enabled=true

# =========================
# RESILIENCE4J - TIME LIMITER
# =========================
resilience4j.timelimiter.instances.employeServiceCB.timeout-duration=5s
resilience4j.timelimiter.instances.congeServiceCB.timeout-duration=5s

# =========================
# ACTUATOR
# =========================
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true

# =========================
# LOGGING
# =========================
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.io.github.resilience4j=DEBUG
logging.level.com.emsi.gateway_server=DEBUG